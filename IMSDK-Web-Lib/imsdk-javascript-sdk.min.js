(function(c,b){c.IMSDK={};var a={onInitialized:null,onDisConnected:null,onConnected:null,onConnectedError:null,onTextReceived:null,onImageReceived:null,onVoiceReceived:null,onSystemMsgReceived:null};c.IMSDK=function(e,n){if(e==null||typeof(e)!=="string"||e.length==0){return}b.extend(this,{VERSION:"0.0.1"});var f=b.extend({accepts:"",cache:false,crossDomain:true,dataType:"json",type:"POST",timeout:30000,contentType:"application/json",xhrFields:{withCredentials:true},beforeSend:function(t,s){t.setRequestHeader("x-rid",Date.now());t.setRequestHeader("x-imsdk-id",this.imsdk_id)}},c.Global_Config);b.ajaxSetup(f);var g="http://";var r="/v1";var p=g+"rest.imsdk.im"+r;b.extend(this,a,n);var h=false;var o=false;this.current={cid:null,photo:null,nick_name:null};var m=this;this.app_key=e;this.imsdk_id="";var j=p;var k={REGISTER:j+"/reg",LOGIN:j+"/login",LOGOUT:j+"/logout",GET_USER:j+"/user/{cid}",FRIENDS:j+"/friends",MSG:j+"/msg",NEW_MSG:j+"/onlinemsg"};this.setLogging=function(s){h=s==true?true:false};this.register=function(t,s,v,u){(v&&typeof(v)=="function")||(v=function(){});(u&&typeof(u)=="function")||(u=function(){});if(o){u.call(m,-2,"重复的登录，要更换登录用户，请先登录");return}if(typeof(t)!=="string"||t.length==0){u.call(m,4,"Token 不能为空");return}var w=b.extend(s,{token:t,app_key:this.app_key,nick_name:"",photo:""});q(this,k.REGISTER,w,function(x,y){o=true;this.current.cid=x;v.call(this,x)},u)};this.login=function(w,s,t,u){(t&&typeof(t)=="function")||(t=function(){});(u&&typeof(u)=="function")||(u=function(){});if(o){u.call(this,-2,"重复的登录，要更换登录用户，请先登出");return}var v={app_key:this.app_key,cid:w,password:s};q(this,k.LOGIN,v,function(x){o=true;this.imsdk_id=x.IMSDKID;delete x.IMSDKID;b.extend(this.current,x);d.call(this);t.call(this,x)},u)};this.logout=function(t,s){(t&&typeof(t)=="function")||(t=function(){});(s&&typeof(s)=="function")||(s=function(){});q(this,k.LOGOUT,{},function(u){o=false;b.extend(this.current,{});t.call(this,u)},s)};this.getStatus=function(){return o};this.getUserInfo=function(t){var s=k.GET_USER.replace("{user}",this.current.cid);return l(this,s,{})};this.getFriends=function(t){var s=k.FRIENDS;return l(this,s,{})};this.sendUserMsg=function(s,u,t){(u&&typeof(u)=="function")||(u=function(){});(t&&typeof(t)=="function")||(t=function(){});s.target_type="user";q(this,k.MSG,s,u,t)};this.sendTeamMsg=function(s,u,t){(u&&typeof(u)=="function")||(u=function(){});(t&&typeof(t)=="function")||(t=function(){});s.target_type="team";q(this,k.MSG,s,u,t)};var i=function(t,u,s){q(this,k.MSG,t,u,s)};var q=function(s,t,w,v,u){b.ajax({url:t,data:c.IMSDK.ParamsBuilder.buildPostData(w),context:s||this,complete:function(x,A){try{var y=x.responseJSON;if(y.status==0){v.call(m,y.data,w)}else{u.call(m,y.status,y.error_msg,w)}}catch(z){u.call(m,-1,z)}}})};var l=function(t,u,v){var s=null;b.ajax({url:u,data:v,type:"GET",async:false,context:t||this,complete:function(w,z){try{var x=w.responseJSON;if(x.status==0){s={code:0,data:x.data}}else{s={code:x.status,error_msg:x.error_msg}}}catch(y){s={code:-1,error_msg:y}}}});return s};var d=function(){if(!o){m.onDisConnected&&typeof(m.onDisConnected)==="function"&&m.onDisConnected.call(m);return}var s=k.NEW_MSG;b.ajax({url:s,data:{},context:m,complete:function(v,y){var t=true;try{var w=v.responseJSON;switch(w.status){case 0:var u=w.data;b.each(u,function(A,C){var B=C.type;var z=C.data;switch(B){case"p2p":b.each(z,function(D,E){switch(E.msg_type){case"voice":m.onVoiceReceived&&typeof(m.onVoiceReceived)==="function"&&m.onVoiceReceived.call(m,E);break;case"img":m.onImageReceived&&typeof(m.onImageReceived)==="function"&&m.onImageReceived.call(m,E);break;default:m.onTextReceived&&typeof(m.onTextReceived)==="function"&&m.onTextReceived.call(m,E);break}})}});break;case 4:o=false;break;case 1:case 2:case 3:console.error("get msg error - [ code:"+w.status+" msg:"+w.error_msg+"]");t=false;break;default:console.error("get msg error - [ code:"+w.status+" msg:"+w.error_msg+"]");break}}catch(x){console.warn("get msg exception - "+x)}if(t){d.call(m)}}})};this.onInitialized&&typeof(this.onInitialized)==="function"&&this.onInitialized({app_key:this.app_key})};c.IMSDK.ParamsBuilder=function(){return{buildPostData:function(d){if(typeof(d)!=="object"){return null}return JSON.stringify(d)}}}()}(window,jQuery));